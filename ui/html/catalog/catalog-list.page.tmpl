{{template "base" .}}

{{define "main"}}
    <main class="form-main">
        <div class="card">
            <div class="card-header">
                Задачи для загрузки
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item">
                    <button class="btn btn-primary bi bi-file-earmark-plus " onclick="document.location='/catalog-create'">
                        <span style="margin-left: 5px">Создать</span></button>
                </li>
                <li class="list-group-item">
                    {{/*                    <div class="container  table-responsive">*/}}
                    <table id="json_data"
                           class="table table-striped table-bordered table-sm table-responsive"></table>
                    {{/*                    </div>*/}}
                </li>
            </ul>
        </div>
        <script>
            fetch('/api/catalog-list',
                {
                    method: 'POST',
                    headers: {
                        "Content-Type": "application/json"
                    },

                })
                .then(response => response.json())
                .then((response) => {
                    if (response.text != 'not-login') {
                        let table = document.getElementById("json_data");
                        let htmlData = '<tr><th>Наименование</th><th>Таблица БД</th></tr>';
                        response.map(function (item) {
                            htmlData += '<tr>' +
                                '<td><a href="/task-edit/?id=$id">' + item.name + '</a> </td>' +
                                '<td>' + item.table_name + '</td>' +
                                '<td  width="32px"><i class="bi-trash text-danger" style="cursor: pointer" onclick="deleteTask('+item.id+')"></i></td>' +
                                // '<td>' +
                                // '<button type="submit" class="btn btn-primary"><i class="icon-save icon-white"></i> ываыаыаы</button>' +
                                // '</td>' +
                                '</tr> ';


                            htmlData = htmlData.replaceAll("$id", item.id)
                        })
                        table.innerHTML = htmlData;
                    } else {
                        document.location = '/'
                    }
                });

            function deleteTask(id) {
                alert(id)
            }
        </script>
    </main>
{{end}}